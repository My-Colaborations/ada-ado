# Ada Database Objects

[![Build Status](https://img.shields.io/jenkins/s/http/jenkins.vacs.fr/Ada-ADO.svg)](http://jenkins.vacs.fr/job/Ada-ADO/)
[![Test Status](https://img.shields.io/jenkins/t/http/jenkins.vacs.fr/Ada-ADO.svg)](http://jenkins.vacs.fr/job/Ada-ADO/)
[![Documentation Status](https://readthedocs.org/projects/ada-ado/badge/?version=latest)](http://ada-ado.readthedocs.io/en/latest/?badge=latest)
[![Download](https://img.shields.io/badge/download-1.2.0-brightgreen.svg)](http://download.vacs.fr/ada-ado/ada-ado-1.2.0.tar.gz)
[![License](http://img.shields.io/badge/license-APACHE2-blue.svg)](LICENSE)
![Commits](https://img.shields.io/github/commits-since/stcarrez/ada-ado/1.2.0.svg)

Ada Database Objects is an Ada05 library that provides
object relational mapping to access a database in Ada05.
The library supports Postgresql, MySQL, SQLite as databases.
Most of the concepts developped for ADO come from the Java Hibernate ORM.

You need at least one of these databases (or all of then).  The configure script will now
fail if no supported database was found.  Check the [Database Drivers](#database-drivers)
section to install them and run the configure again after the installation.

# Build

To build ADO, you will need:

* [Ada Util](https://github.com/stcarrez/ada-util)
* [XML/Ada](http://libre.adacore.com/libre/tools/xmlada/)

You should have installed either Postgresql, MySQL or SQLite before
running the configure script.  For Windows, please read
the file [win32/README](win32/README.md) that gives some installation hints.

Build with the following commands:
```
   ./configure
   make
```
The unit tests are built and executed using:
```
   make test
```
And unit tests are executed with:
```
   bin/ado_harness -config test-mysql.properties
```
or
```
   bin/ado_harness -config test-sqlite.properties
```
or
```
   bin/ado_harness -config test-postgresql.properties
```

The *ADO Programmer's Guide* is generated by using [Dynamo](https://github.com/stcarrez/dynamo)
and [Pandoc](https://pandoc.org).  It is created by the following command:
```
   make doc
```

and the book is generated in the *ado-book.pdf* file.

# Samples

The samples can be built using:
```
      gnatmake -Psamples
```   

Before launching the samples, the database must have been created.
For SQLite, use:
```
      make samples.db
```

# Documentation

The Ada Database Objects sources as well as a wiki documentation is provided on:

  * [Ada Database Objects Programmer's Guide](http://ada-ado.readthedocs.io/en/latest/)
  * [ADO Documentation](https://github.com/stcarrez/ada-ado/wiki)
  * [ADO Sessions](https://github.com/stcarrez/ada-ado/wiki/ADO_Sessions)
  * [ADO Statements](https://github.com/stcarrez/ada-ado/wiki/ADO_Statements)
  * [ADO Queries](https://github.com/stcarrez/ada-ado/wiki/ADO_Queries)
  * [ADO Drivers](https://github.com/stcarrez/ada-ado/wiki/ADO_Drivers)


# Database Drivers

The MySQL and SQLite development headers and runtime are necessary for building
the ADO driver.  The configure script will use them to enable the ADO drivers.

Postgresql Development installation
```
      sudo apt-get install postgresql-client-9.5 libpq-dev
```

MySQL Development installation
```
      sudo apt-get install mariadb-client libmariadb-client-lgpl-dev
```

SQLite Development installation
```
      sudo apt-get install sqlite3 libsqlite3-dev
```
For Windows, check [win32/README](win32/README.md) to install the libraries.


## Database Creation

Create the tests database by using the Dynamo command.
(Dynamo is available at: https://github.com/stcarrez/dynamo)
Note: change 'root' and 'password' to a MySQL user that has admin access rights
('create database' and 'grant option' privileges).
```
      dynamo create-database db/regtests root password
```
The default database connection string is defined in dynamo.xml.
You can also specify the connection string and create the schema by using:
```
      dynamo create-database db/regtests 'mysql://localhost:3306/ado_test?user=ado' root password
```
To create manually the database, you can proceed to the following steps:

1. Create the 'ado_test' database in MySQL
```
         mysql -u root
         mysql> create database ado_test;
```
2. Create the 'ado' user and give the access rights:
```
         mysql> grant select, insert, update, delete,
                      create, drop, create temporary tables, execute,
                      show view on `ado_test`.* to ado@'localhost';
         mysql> flush privileges;
```
3. Create the tables
```
         mysql> use ado_test
         mysql> source db/regtests/mysql/create-ado-mysql.sql
```

# Building documentation

```
      sudo apt-get install pandoc xsltproc texlive-latex-base texlive-latex-extra texlive-fonts-extra
```
